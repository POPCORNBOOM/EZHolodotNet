<ui:FluentWindow x:Class="EZHolodotNet.Views.ThreeDPreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EZHolodotNet.Views"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:core="clr-namespace:EZHolodotNet.Core"
        mc:Ignorable="d" ExtendsContentIntoTitleBar="True" WindowBackdropType="Mica" WindowCornerPreference="Default" 
        Title="3D动态预览" Height="650" Width="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        
        <Viewbox Margin="0" Stretch="UniformToFill">
            <Border HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Width="1000" Height="500"
                    Background="{StaticResource ChessboardBrush}">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="1" Color="Black"/>
                </Border.Effect>
            </Border>
        </Viewbox>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>
            <Image Source="{Binding DisplayImageScratch3DLeft}" HorizontalAlignment="Center">
                <Image.Style>
                    <Style>
                        <Setter Property="Grid.Column" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsParallelEye3DMode}" Value="true">
                                <Setter Property="Grid.Column" Value="1"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Image.Style>
            </Image>
            <Image Source="{Binding DisplayImageScratch3DRight}" HorizontalAlignment="Center">
                <Image.Style>
                    <Style>
                        <Setter Property="Grid.Column" Value="1"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsParallelEye3DMode}" Value="true">
                                <Setter Property="Grid.Column" Value="0"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Image.Style>
            </Image>
            <Label HorizontalAlignment="Right" Foreground="White" Margin="10">
                <Label.Style>
                    <Style TargetType="Label">
                        <Setter Property="Content" Value="右眼"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsParallelEye3DMode}" Value="true">
                                <Setter Property="Content" Value="左眼"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Label.Style>
            </Label>
            <Label Grid.Column="1" HorizontalAlignment="Left" Foreground="White" Margin="10">
                <Label.Style>
                    <Style TargetType="Label">
                        <Setter Property="Content" Value="左眼"/>
                        <Style.Triggers>
                        <DataTrigger Binding="{Binding IsParallelEye3DMode}" Value="true">
                                <Setter Property="Content" Value="右眼"/>
                        </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Label.Style>
            </Label>
            <Ellipse Fill="Red" Width="5" Height="5" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="12"/>
            <Ellipse Grid.Column="1" Fill="Red" Width="5" Height="5" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="12"/>
        </Grid>
        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
            <TextBlock Foreground="White">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Text" Value="请使用交叉眼(斗鸡眼)观察"/>
                        <Style.Triggers>
                        <DataTrigger Binding="{Binding IsParallelEye3DMode}" Value="true">
                            <Setter Property="Text" Value="请使用平行眼(失焦眼)观察"/>
                        </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <ui:Button Width="13" Height="13" Margin="4,0" Foreground="White" VerticalAlignment="Center" Icon="{ui:SymbolIcon Symbol=Question24}" Appearance="Light" Padding="0">
                <ui:Button.ToolTip>
                    <StackPanel>
                        <Image Margin="0" Stretch="Uniform" Source="/Images/instruction.png"/>
                        <TextBlock FontSize="10">
                            <Run Text="{Binding [Text_Parallel_Eyes], Source={x:Static core:LanguageManager.Instance}}" FontWeight="Bold"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_1], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_2], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_3], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_4], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_5], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_6], Source={x:Static core:LanguageManager.Instance}}"/>
                            <LineBreak/>
                            <Run Text="{Binding [Text_Cross_Eyes], Source={x:Static core:LanguageManager.Instance}}" FontWeight="Bold"/>
                            <LineBreak/>
                            <Run Text="{Binding [Tips_Eyes_7], Source={x:Static core:LanguageManager.Instance}}"/>

                        </TextBlock>
                    </StackPanel>
                </ui:Button.ToolTip>
            </ui:Button>
        </StackPanel>
        <TextBlock HorizontalAlignment="Left" VerticalAlignment="Bottom" Foreground="White">
            <Run Text="Fps"/>
            <Run Text="{Binding RealTimeFps,StringFormat={}{0:0.00}}"/>
        </TextBlock>
        <ui:TitleBar/>

        <Expander Grid.Row="1" IsExpanded="True" Header="预览控制">
            <StackPanel>
                <ui:ToggleSwitch Margin="0,0,0,8" Content="{Binding [Text_Auto_Play], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsAutoPlay3D}"/>
                <ui:ToggleSwitch Margin="0,0,0,8" Content="{Binding [Text_Parallel_Eyes_Mode], Source={x:Static core:LanguageManager.Instance}}"  IsChecked="{Binding IsParallelEye3DMode}">

                </ui:ToggleSwitch>
                <Expander Header="预览控制" IsExpanded="{Binding IsAutoPlay3D,Mode=OneWay,Converter={StaticResource BooleanInverseConverter}}" Visibility="{Binding IsAutoPlay3D,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=i}">
                    <StackPanel>
                        <ui:TextBlock>
                            <Run Text="{Binding [Globe_Step], Source={x:Static core:LanguageManager.Instance}}"/>
                            <Run Text="{Binding PreviewStep,StringFormat={}{0:0.00}}"/>
                        </ui:TextBlock>
                        <Slider Minimum="0"
                        Maximum="1" 
                        IsEnabled="{Binding IsAutoPlay3D,Converter={StaticResource BooleanInverseConverter}}"
                        Value="{Binding PreviewStep}"
                        TickFrequency="0.05"
                        TickPlacement="BottomRight"
                        IsSnapToTickEnabled="True"/>
                        <ui:TextBlock>
                            <Run Text="{Binding [Text_Eyes_Spacing], Source={x:Static core:LanguageManager.Instance}}"/>
                            <Run Text="{Binding PreviewStepDistance,StringFormat={}{0:0.00}}"/>
                        </ui:TextBlock>
                        <Slider Minimum="0"
                        Maximum="0.3" 
                        Value="{Binding PreviewStepDistance}"
                        IsEnabled="{Binding IsAutoPlay3D,Converter={StaticResource BooleanInverseConverter}}"
                        TickFrequency="0.05"
                        TickPlacement="BottomRight"
                        IsSnapToTickEnabled="True"/>
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowPrevious24}" Grid.Column="0" Command="{Binding ChangePreviewCommand}" CommandParameter="5"/>
                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowLeft24}" Grid.Column="1" Command="{Binding ChangePreviewCommand}" CommandParameter="6"/>
                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=CenterHorizontal24}" Grid.Column="2" Command="{Binding ChangePreviewCommand}" CommandParameter="7"/>
                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowRight24}" Grid.Column="3" Command="{Binding ChangePreviewCommand}" CommandParameter="8"/>
                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowNext24}" Grid.Column="4" Command="{Binding ChangePreviewCommand}" CommandParameter="9"/>
                        </Grid>
                        <TextBlock>
                            <Run Text="{Binding [Text_Color_of_Points], Source={x:Static core:LanguageManager.Instance}}"/>
                        </TextBlock>

                        <ComboBox Margin="0,0,0,4" SelectedIndex="{Binding PreviewColorMode}">
                            <ComboBoxItem Content="{Binding [Text_Single_Color], Source={x:Static core:LanguageManager.Instance}}"/>
                            <ComboBoxItem Content="{Binding [Text_Original_Color], Source={x:Static core:LanguageManager.Instance}}"/>
                            <ComboBoxItem Content="{Binding [Text_Depth_Color], Source={x:Static core:LanguageManager.Instance}}"/>
                        </ComboBox>
                        <ui:TextBox Icon="{ui:SymbolIcon Symbol=NumberSymbol24}" Visibility="{Binding PreviewColorMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=0}" PlaceholderText="#" Margin="0,0,0,4"
                                    Text="{Binding PreviewColor,UpdateSourceTrigger=LostFocus}"/>
                    </StackPanel>
                </Expander>
                <Expander Header="播放设置" IsExpanded="{Binding IsAutoPlay3D,Mode=OneWay}">
                    <StackPanel>
                        <ui:TextBlock>
                            <Run Text="{Binding [Text_Maximum_Frame_Per_Second], Source={x:Static core:LanguageManager.Instance}}"/>
                            <Run Text="{Binding AutoPlayMaxFps,StringFormat={}{0:0.00}}"/>
                        </ui:TextBlock>
                        <Slider Minimum="1"
                                Maximum="45" 
                                Value="{Binding AutoPlayMaxFps}"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                IsSnapToTickEnabled="True"/>
                    </StackPanel>
                </Expander>
            </StackPanel>
        </Expander>

    </Grid>
</ui:FluentWindow>
