<ui:FluentWindow x:Class="EZHolodotNet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:EZHolodotNet"
        xmlns:core="clr-namespace:EZHolodotNet.Core" ExtendsContentIntoTitleBar="True" WindowBackdropType="Mica" WindowCornerPreference="Default"
        mc:Ignorable="d" AllowDrop="True" DragEnter="Window_DragEnter" DragLeave="Window_DragLeave" Closing="Window_Closing"
        Title="EZHolo" Height="720" Width="1080" MinHeight="450" MinWidth="850" MouseMove="Window_MouseMove" MouseUp="Window_MouseUp" MouseLeave="Window_MouseLeave">
    <ui:FluentWindow.InputBindings>
        <!-- 文件操作 -->
        <KeyBinding Gesture="Ctrl+V" Command="{Binding ChooseImageCommand}" CommandParameter="FROMCLIPBOARD"/>
        <KeyBinding Gesture="Ctrl+R" Command="{Binding ChooseImageCommand}"/>
        <KeyBinding Gesture="Ctrl+U" Command="{Binding UnloadImageCommand}"/>
        <KeyBinding Gesture="Ctrl+E" Command="{Binding ExportPathCommand}"/>
        <KeyBinding Gesture="Ctrl+Alt+E" Command="{Binding ExportPathCommand}"/>

        <!-- 深度图操作 -->
        <KeyBinding Gesture="Ctrl+Shift+E" Command="{Binding ExportDepthCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+I" Command="{Binding ImportDepthCommand}"/>

        <!-- 点图操作 -->
        <KeyBinding Gesture="Ctrl+Shift+P" Command="{Binding ExportPointsCommand}" CommandParameter="a"/>
        <KeyBinding Gesture="Ctrl+Alt+P" Command="{Binding ExportPointsCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding ExportSvgPointsCommand}" CommandParameter="a"/>
        <KeyBinding Gesture="Ctrl+Alt+S" Command="{Binding ExportSvgPointsCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+M" Command="{Binding ImportPointsCommand}"/>

        <!-- 配置操作 -->
        <KeyBinding Gesture="Ctrl+S" Command="{Binding ExportConfigCommand}"/>
        <KeyBinding Gesture="Ctrl+L" Command="{Binding ImportConfigCommand}"/>

        <!-- 编辑操作 -->
        <KeyBinding Gesture="Ctrl+Z" Command="{Binding UndoStepCommand}"/>
        <KeyBinding Gesture="Ctrl+Y" Command="{Binding RedoStepCommand}"/>

        <!-- 工具操作 -->
        <KeyBinding Gesture="F5" Command="{Binding ProcessDepthCommand}"/>
        <KeyBinding Gesture="Ctrl+G" Command="{Binding CreateScratchCommand}"/>
        <KeyBinding Gesture="F12" Command="{Binding DebugCommand}" CommandParameter="DepthContourMapContrast"/>
        
        <!--手动采样工具 -->
        <KeyBinding Key="Q" Command="{Binding SetManualToolCommand}" CommandParameter="0"/>
        <KeyBinding Key="W" Command="{Binding SetManualToolCommand}" CommandParameter="1"/>
        <KeyBinding Key="E" Command="{Binding SetManualToolCommand}" CommandParameter="2"/>
        <KeyBinding Key="A" Command="{Binding SetManualToolCommand}" CommandParameter="3"/>
        <KeyBinding Key="S" Command="{Binding SetManualToolCommand}" CommandParameter="4"/>
        <KeyBinding Key="D" Command="{Binding SetManualToolCommand}" CommandParameter="5"/>
        <KeyBinding Key="Z" Command="{Binding SetManualToolCommand}" CommandParameter="6"/>
        
        
    </ui:FluentWindow.InputBindings>
    <ui:FluentWindow.Resources>
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
        <Storyboard x:Key="FadeOutAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="1" To="0" Duration="0:0:0.3"/>
        </Storyboard>
    </ui:FluentWindow.Resources>

    <Grid>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="1*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="200" Width="*" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition MinWidth="200" Width="*" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition MinWidth="200" Width="*" />
        </Grid.ColumnDefinitions>
        <Border IsHitTestVisible="False" Grid.ColumnSpan="5">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Opacity" Value="0"/>

                    <!-- 当绑定的 IsVisible 为 true 时显示 -->
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsTipsPanelVisible}" Value="True">
                            <DataTrigger.EnterActions>
                                <!-- 显示时执行渐显动画 -->
                                <BeginStoryboard Storyboard="{StaticResource FadeInAnimation}"/>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <!-- 隐藏时执行渐隐动画 -->
                                <BeginStoryboard Storyboard="{StaticResource FadeOutAnimation}"/>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Border.Background>
                <LinearGradientBrush>
                    <GradientStop Offset="0.6"/>
                    <GradientStop Offset="0.7" Color="#FF559CE4"/>
                    <GradientStop Offset="1" Color="#FF559CE4"/>
                </LinearGradientBrush>
            </Border.Background>
            <TextBlock IsHitTestVisible="False" Foreground="White" Text="{Binding TipsString}" FontSize="14" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="8"/>
        </Border>

        <ui:TitleBar Grid.Column="1" Grid.ColumnSpan="4"/>
        <Menu Grid.ColumnSpan="5">
            <ui:MenuItem Header="{Binding [Toolbar_File], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=Document24}">
                <ui:MenuItem Header="{Binding [Toolbar_Open_New_Image], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+R" Icon="{ui:SymbolIcon Symbol=ImageAdd24}" Command="{Binding ChooseImageCommand}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Close_Image], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+U" IsEnabled="{Binding IsOriginalImageLoaded}" Icon="{ui:SymbolIcon Symbol=ImageOff24}" Command="{Binding UnloadImageCommand}"/>
                <Separator/>

                <ui:MenuItem Header="{Binding [Toolbar_Depth_Image], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=DocumentCatchUp24}">
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Depth], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Shift+E" ToolTip="将会丢失小数精度" 
                     Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportDepthCommand}"/>
                    <ui:MenuItem Header="{Binding [Toolbar_Import_Depth], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Shift+I" 
                     Icon="{ui:SymbolIcon Symbol=ArrowImport24}" Command="{Binding ImportDepthCommand}"/>
                </ui:MenuItem>
                <Separator/>

                <ui:MenuItem Header="{Binding [Toolbar_Point_Map], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=GridDots24}">
                    <!-- PNG导出组 -->
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Point_to_PNG_Combined], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Shift+P" 
                     Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportPointsCommand}" CommandParameter="a"/>
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Point_to_PNG_Manual], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Alt+P" 
                     Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportPointsCommand}"/>
                    <Separator/>
                    <!-- SVG导出组 -->
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Point_to_SVG_Combined], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Shift+S" 
                     Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportSvgPointsCommand}" CommandParameter="a"/>
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Point_to_SVG_Manual], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Alt+S" 
                     Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportSvgPointsCommand}"/>
                    <Separator/>
                    <ui:MenuItem Header="{Binding [Toolbar_Import_Point_Map], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Shift+M" 
                     Icon="{ui:SymbolIcon Symbol=ArrowImport24}" Command="{Binding ImportPointsCommand}"/>
                </ui:MenuItem>
                <Separator/>
                <ui:ToggleSwitch Content="{Binding [Text_Use_Last_Config], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsUsingLastConfigEveryTime}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Save_Config], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+S" 
                 Icon="{ui:SymbolIcon Symbol=DocumentSave24}" Command="{Binding ExportConfigCommand}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Load_Config], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+L" 
                 Icon="{ui:SymbolIcon Symbol=DocumentChevronDouble24}" Command="{Binding ImportConfigCommand}"/>
                <Separator/>
                <ui:MenuItem Header="{Binding [Toolbar_Export_Scratch_Path], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+E" Icon="{ui:SymbolIcon Symbol=InkStroke24}" Command="{Binding ExportScratchCommand}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Export_Handcraft_Blueprint], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Alt+E" Icon="{ui:SymbolIcon Symbol=BubbleMultiple20}" Command="{Binding ExportPathCommand}"/>
            </ui:MenuItem>

            <ui:MenuItem Header="{Binding [Toolbar_Edit], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=Edit24}">
                <ui:MenuItem Header="{Binding [Toolbar_Undo], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Z" Icon="{ui:SymbolIcon Symbol=ArrowUndo24}" Command="{Binding UndoStepCommand}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Redo], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Y" Icon="{ui:SymbolIcon Symbol=ArrowRedo24}" Command="{Binding RedoStepCommand}"/>
            </ui:MenuItem>

            <ui:MenuItem Header="{Binding [Toolbar_Tools], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=Wrench24}">
                <ui:MenuItem Header="{Binding [Toolbar_Re-estimate], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="F5" 
                 Icon="{ui:SymbolIcon Symbol=CatchUp24}" Command="{Binding ProcessDepthCommand}"/>
                <ui:MenuItem Header="{Binding [Toolbar_Generate_Preview_Path], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+G" Icon="{ui:SymbolIcon Symbol=EyeLines24}" Command="{Binding CreateScratchCommand}"/>
                <Separator/>
                <ui:MenuItem Header="{Binding [Toolbar_Language], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=BookOpenGlobe24}">
                    <ui:MenuItem Header="{Binding [Toolbar_Bad_Translation_Help_Us], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ProcessStartCommand}" CommandParameter="https://github.com/POPCORNBOOM/EZHolodotNet"/>
                    <Separator/>
                    <ui:MenuItem Header="English" InputGestureText="en" Command="{Binding SwitchLanguageCommand}" CommandParameter=""/>
                    <ui:MenuItem Header="中文(简体)" InputGestureText="zh-CN" Command="{Binding SwitchLanguageCommand}" CommandParameter="zh-CN"/>
                    <ui:MenuItem Header="中文(繁体)" InputGestureText="zh-Hant" Command="{Binding SwitchLanguageCommand}" CommandParameter="zh-Hant"/>
                    <ui:MenuItem Header="日本語" InputGestureText="ja-JP" Command="{Binding SwitchLanguageCommand}" CommandParameter="ja-JP"/>
                    <ui:MenuItem Header="Français" InputGestureText="fr" Command="{Binding SwitchLanguageCommand}" CommandParameter="fr"/>
                    <ui:MenuItem Header="Русский язык" InputGestureText="ru" Command="{Binding SwitchLanguageCommand}" CommandParameter="ru"/>
                    <ui:MenuItem Header="Deutsch" InputGestureText="de" Command="{Binding SwitchLanguageCommand}" CommandParameter="de"/>
                </ui:MenuItem>
                <ui:MenuItem Header="{Binding [Toolbar_Theme], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=DarkTheme24}">
                    <ui:MenuItem Header="明亮" InputGestureText="Light" Command="{Binding SwitchThemeCommand}" CommandParameter="2"/>
                    <ui:MenuItem Header="阴暗" InputGestureText="Dark" Command="{Binding SwitchThemeCommand}" CommandParameter="1"/>
                </ui:MenuItem>
                <Separator/>
                <ui:MenuItem Header="{Binding [Toolbar_Open_Source_Info], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=BookInformation24}" Command="{Binding OpenCustomMessageBoxCommand}"/>
                <Separator/>
                <ui:MenuItem Header="{Binding [Toolbar_Shortcut_Key_Reference], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=Keyboard24}">
                    <!-- 文件操作 -->
                    <ui:MenuItem InputGestureText="Ctrl+V" Header="{Binding [Toolbar_Import_Image_from_Clipboard], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+R" Header="{Binding [Toolbar_Import_Image_from_File], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+U" Header="{Binding [Shortcut_Close_Image], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+E" Header="{Binding [Toolbar_Export_Scratch_Path], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem Header="{Binding [Toolbar_Export_Handcraft_Blueprint], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="Ctrl+Alt+E"/>

                    <Separator/>

                    <!-- 深度图操作 -->
                    <ui:MenuItem InputGestureText="Ctrl+Shift+E" Header="{Binding [Shortcut_Export_Depth_Map], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Shift+I" Header="{Binding [Shortcut_Import_Depth_From_File], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Separator/>

                    <!-- 点图操作 -->
                    <ui:MenuItem InputGestureText="Ctrl+Shift+P" Header="{Binding [Shortcut_Export_Point_to_PNG_Combined], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Alt+P" Header="{Binding [Shortcut_Export_Point_to_PNG_Manual], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Shift+S" Header="{Binding [Shortcut_Export_Point_to_SVG_Combined], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Alt+S" Header="{Binding [Shortcut_Export_Point_to_SVG_Manual], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Shift+M" Header="{Binding [Shortcut_Import_Point_from_File], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Separator/>

                    <!-- 配置操作 -->
                    <ui:MenuItem InputGestureText="Ctrl+S" Header="{Binding [Shortcut_Save_Config], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+L" Header="{Binding [Shortcut_Load_Config], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Separator/>

                    <!-- 编辑操作 -->
                    <ui:MenuItem InputGestureText="Ctrl+Z" Header="{Binding [Shortcut_Undo], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+Y" Header="{Binding [Shortcut_Redo], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Separator/>

                    <!-- 工具操作 -->
                    <ui:MenuItem InputGestureText="F5" Header="{Binding [Shortcut_Re-estimate], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Ctrl+G" Header="{Binding [Shortcut_Generate_Path], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Separator/>

                    <!--手动采样工具 -->
                    <ui:MenuItem InputGestureText="Q" Header="{Binding [Shortcut_Switch_to_Cursor], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="W" Header="{Binding [Shortcut_Switch_to_Pencil], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="E" Header="{Binding [Shortcut_Switch_to_Eraser], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="A" Header="{Binding [Shortcut_Switch_to_Line], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="S" Header="{Binding [Shortcut_Switch_to_Smear], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="D" Header="{Binding [Shortcut_Switch_to_Draft], Source={x:Static core:LanguageManager.Instance}}"/>
                    <ui:MenuItem InputGestureText="Z" Header="{Binding [Shortcut_Switch_to_Dedense], Source={x:Static core:LanguageManager.Instance}}"/>
                </ui:MenuItem>

                <Separator/>
                <ui:MenuItem Header="{Binding [Shortcut_Debug], Source={x:Static core:LanguageManager.Instance}}" InputGestureText="F12" Command="{Binding DebugCommand}" CommandParameter="DepthContourMapContrast"/>
            </ui:MenuItem>
        </Menu>
        <Border Grid.Row="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="300"  MinHeight="200"/>
                    <RowDefinition Height="5" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="1*" />
                </Grid.RowDefinitions>
                <Viewbox HorizontalAlignment="Center" Margin="0" VerticalAlignment="Stretch" Stretch="UniformToFill"  MouseWheel="Viewbox_MouseWheel" MouseDown="Viewbox_MouseDown">
                    <Border x:Name="BorderOriginalImage" Width="200" 
                            Height="200"
                            Background="{StaticResource ChessboardBrush}"
                            AllowDrop="True"
                            DragEnter="BorderOriginalImage_DragEnter"
                            Drop="BorderOriginalImage_Drop">

                    </Border>
                </Viewbox>
                <Grid Margin="0" ClipToBounds="True">

                    <Grid RenderTransformOrigin="0.5,0.5" Grid.ColumnSpan="2" Grid.RowSpan="2">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <TranslateTransform X="{Binding PreviewX}" Y="{Binding PreviewY}"/>
                                <ScaleTransform ScaleX="{Binding PreviewScale,Mode=OneWay}" ScaleY="{Binding PreviewScale,Mode=OneWay}"/>
                            </TransformGroup>
                        </Grid.RenderTransform>
                        <Image Name="LIMAGE" MouseWheel="Image_MouseWheel" MouseMove="Image_MouseMove" MouseDown="Image_MouseDown" MouseUp="Image_MouseUp" MouseLeave="Image_MouseLeave" RenderTransformOrigin="0.5,0.5" MaxHeight="300" Source="{Binding FilePath}" Stretch="Uniform">
                        </Image>
                        <Viewbox Visibility="{Binding MouseOnLMR,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=0|3}" Cursor="Cross" MaxHeight="300" Stretch="Uniform" IsHitTestVisible="False">
                            <Grid>
                                <Canvas Visibility="{Binding IsManualEditing,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Line Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=3,Mode=OneWay}" X1="{Binding StartMousePointX,Mode=OneWay}" Y1="{Binding StartMousePointY,Mode=OneWay}" X2="{Binding MousePointX,Mode=OneWay}" Y2="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False" Stroke="White" StrokeThickness="2"/>
                                </Canvas>
                                <Canvas Visibility="{Binding IsMouseMoving,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Ellipse Canvas.Left="{Binding MousePointX,Mode=OneWay}"
                                             Canvas.Top="{Binding MousePointY,Mode=OneWay}"
                                             Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2|4|5,Mode=OneWay}"
                                             Width="{Binding ToolDiameter,Mode=OneWay}"
                                             Height="{Binding ToolDiameter,Mode=OneWay}"
                                             IsHitTestVisible="False"
                                             Fill="#AAFFFFFF"
                                             Stroke="White"
                                             StrokeThickness="2">
                                        <Ellipse.RenderTransform>
                                            <TransformGroup>
                                                <TranslateTransform X="{Binding MToolRadius,Mode=OneWay}" Y="{Binding MToolRadius,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Ellipse.RenderTransform>
                                    </Ellipse>

                                    <Border Padding="8" CornerRadius="0,16,16,16" Background="{Binding MouseDepthColorBW}" Canvas.Left="{Binding MousePointX,Mode=OneWay}" Canvas.Top="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False">
                                        <Border.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="{Binding RePreviewScale,Mode=OneWay}" ScaleY="{Binding RePreviewScale,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Border.RenderTransform>
                                        <TextBlock Foreground="{Binding MouseDepthColor}" FontSize="48" FontWeight="Bold">
                                            <Run Text="D"/>
                                            <Run Text="{Binding MouseDepth,StringFormat={}{0:0.00},Mode=OneWay}"/>
                                        </TextBlock>
                                    </Border>
                                </Canvas>
                            </Grid>
                        </Viewbox>
                    </Grid>
                </Grid>
                <TextBlock HorizontalAlignment="Center" FontSize="10" Foreground="White" VerticalAlignment="Center" TextAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsOriginalImageLoaded}" Value="true">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                    <Run Text="{Binding [Title_EZHOLO], Source={x:Static core:LanguageManager.Instance}}" FontSize="14"/>
                    <Run Text="{Binding [Tips_Start_Your_Work], Source={x:Static core:LanguageManager.Instance}}" FontSize="14"/>
                    <LineBreak/>
                    <Run Text="{Binding [Tips_Open_Image_or_Click_to_Choose_Image], Source={x:Static core:LanguageManager.Instance}}"/>                    
                    <LineBreak/>
                    <Run Text="{Binding [Globe_Or], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Hyperlink Command="{Binding ChooseImageCommand}" CommandParameter="FROMCLIPBOARD">
                        <Hyperlink.Style>
                            <Style TargetType="Hyperlink">
                                <Setter Property="Foreground" Value="#559CE4"/>
                                <Style.Triggers>
                                    <EventTrigger RoutedEvent="Mouse.MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Duration="0:0:0.1" Storyboard.TargetProperty="Foreground.Color" To="#E46633"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="Mouse.MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Duration="0:0:0.5" Storyboard.TargetProperty="Foreground.Color" To="#559CE4"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Style.Triggers>
                            </Style>
                        </Hyperlink.Style>
                        <Run Text="{Binding [Tips_Click_Here_to], Source={x:Static core:LanguageManager.Instance}}" />
                        <ui:SymbolIcon Symbol="Clipboard24" Margin="-4,-2,-2,-2"/>
                        <Run Text="{Binding [Tips_Import_from_Clipboard], Source={x:Static core:LanguageManager.Instance}}" />
                    </Hyperlink>
                </TextBlock>

                <TextBlock VerticalAlignment="Bottom" Foreground="#B3B3B3" Margin="0" FontSize="7">
                    <Run Text="{Binding FilePath,Mode=OneWay}"/>
                    <Run Text="@"/>
                    <Run Text="{Binding OriginImageWidth,Mode=OneWay}"/>
                    <Run Text=","/>
                    <Run Text="{Binding OriginImageHeight,Mode=OneWay}"/>
                    <Run Text=""/>
                </TextBlock>
                <GridSplitter Background="{DynamicResource ControlFillColorSecondaryBrush}" ResizeBehavior="PreviousAndNext" Grid.Row="1" ResizeDirection="Rows" Height="6" HorizontalAlignment="Stretch"/>
                <StackPanel Grid.ColumnSpan="1" Grid.Row="2" Margin="8,0">
                    <ui:Button Appearance="Primary" HorizontalAlignment="Stretch" Content="{Binding [Text_Click_to_Choose_Image], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ChooseImageCommand}"/>
                    <TextBlock Text="{Binding [Tips_Desired_Size_518px], Source={x:Static core:LanguageManager.Instance}}" Foreground="#D3D3D3" Margin="4,4,0,0" FontSize="12"/>
                    <ui:InfoBar Margin="8,8,8,0" Severity="Warning" Title="{Binding [Tips_Warning], Source={x:Static core:LanguageManager.Instance}}" IsOpen="{Binding IsShowBadOriginalImageWarning}" Message="导入的图片尺寸不佳。可能会影响深度估算质量。推荐比例1:1，最佳边长518"/>
                </StackPanel>
                <Border Background="#E3559CE4" BorderThickness="3" BorderBrush="#80B9EE" 
                        Margin="4" 
                        Visibility="{Binding IsDragEntered,Converter={StaticResource BoolToVisibilityConverter}}"
                        Drop="BorderOriginalImage_Drop" IsHitTestVisible="True">
                    <TextBlock TextAlignment="Center" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ui:SymbolIcon Symbol="Image24" FontSize="32"/>
                        <LineBreak/>
                        <Run Text="{Binding [Text_Import_Original_Image], Source={x:Static core:LanguageManager.Instance}}"/>
                    </TextBlock>
                </Border>

                <ScrollViewer Grid.Row="3">
                    <StackPanel Margin="8">
                        <Expander Header="{Binding [Shortcut_Depth_Estimate], Source={x:Static core:LanguageManager.Instance}}" IsExpanded="True" Margin="8">
                            <StackPanel>
                                <TextBlock Foreground="Gray" FontSize="10">
                                    <Run Text="{Binding [Text_Loaded], Source={x:Static core:LanguageManager.Instance}}"/>
                                    <Run Text="{Binding ModelFilePath,Mode=OneWay}"/>
                                </TextBlock>
                                <Grid Margin="0,4,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="1*" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock VerticalAlignment="Center" Margin="0,0,2,0" Text="{Binding [Text_Model], Source={x:Static core:LanguageManager.Instance}}" HorizontalAlignment="Stretch"/>
                                    <ComboBox SelectionChanged="ComboBox_SelectionChanged" Padding="8,6" SelectedIndex="{Binding SelectedModelPathIndex}" ItemsSource="{Binding ModelsPath}" Grid.Column="1" Margin="2,0,0,0" HorizontalAlignment="Stretch"/>
                                    <ui:Button Margin="2,0,0,0" Grid.Column="2" VerticalAlignment="Stretch" Icon="{ui:SymbolIcon Symbol=Folder24}" Command="{Binding OpenFolderCommand}"/>
                                    <ui:Button Margin="2,0,0,0" Grid.Column="3" VerticalAlignment="Stretch" Icon="{ui:SymbolIcon Symbol=ArrowClockwise24}" Command="{Binding RefreshModelCommand}"/>
                                </Grid>
                                <Button IsEnabled="{Binding IsOriginalImageLoaded}" Margin="0,4,0,0" Content="{Binding [Text_Re-estimate], Source={x:Static core:LanguageManager.Instance}}" ToolTip="重新基于原图估算深度图和梯度" HorizontalAlignment="Stretch" Command="{Binding ProcessDepthCommand}"/>

                                <Grid Margin="0,4,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1*" />
                                        <ColumnDefinition Width="1*" />
                                    </Grid.ColumnDefinitions>
                                    <ui:Button IsEnabled="{Binding IsOriginalImageLoaded}" Margin="0,0,2,0" Content="{Binding [Text_Export_Depth], Source={x:Static core:LanguageManager.Instance}}" ToolTip="将会丢失小数精度" HorizontalAlignment="Stretch" Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportDepthCommand}"/>
                                    <ui:Button IsEnabled="{Binding IsOriginalImageLoaded}" Grid.Column="1" Margin="2,0,0,0" HorizontalAlignment="Stretch" Content="{Binding [Text_Import_Depth], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=ArrowImport24}" Command="{Binding ImportDepthCommand}"/>
                                </Grid>

                            </StackPanel>
                        </Expander>

                        <Expander IsExpanded="True" Margin="8" Header="{Binding [Text_Sampling], Source={x:Static core:LanguageManager.Instance}}" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <CheckBox Content="{Binding [Text_Contour_Sampling_Strategy], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsContourMethodEnabled}"/>
                                <Expander Visibility="{Binding IsContourMethodEnabled,Converter={StaticResource BooleanToVisibilityConverter}}" IsExpanded="True" Header="{Binding [Text_Contour], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:Button Appearance="Primary" ToolTip="【可撤销】将轮廓采样到的点转移到手动采样中，以便进一步精细调整这些点" Icon="{ui:SymbolIcon Symbol=HandDraw24}" Margin="0,0,0,4" HorizontalAlignment="Stretch" Content="{Binding [Text_Migrate_to_Manual], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ConvertToManualCommand}" CommandParameter="c"/>
                                        <ui:ToggleSwitch Content="{Binding [Text_Using_Depth], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsDepthContourMode}"/>
                                        <Separator Margin="0,4"/>
                                        <Border BorderThickness="0" Margin="0" Padding="0">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsDepthContourMode}" Value="true">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Contour_Spacing], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding LineDensity,StringFormat={}{0:0}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="1" Maximum="50"
                                        Value="{Binding LineDensity}" 
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Blur_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding BlurFactor,StringFormat={}{0:0}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="1" Maximum="50"
                                        Value="{Binding BlurFactor}" 
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Lower_Boundary], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding Threshold1,StringFormat={}{0:0}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0" Maximum="255" 
                                        Value="{Binding Threshold1}" 
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Upper_Boundary], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding Threshold2,StringFormat={}{0:0}}"/>
                                                </ui:TextBlock>
                                                <Slider Minimum="0" Maximum="255" 
                                        Value="{Binding Threshold2}" 
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                            </StackPanel>
                                        </Border>
                                        <Border BorderThickness="0" Margin="0" Padding="0">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsDepthContourMode}" Value="true">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <CheckBox IsChecked="{Binding IsBinaryDeNoise}" Content="{Binding [Text_Binary_Denoise], Source={x:Static core:LanguageManager.Instance}}"/>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Detail_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DepthContourDetailFactor,StringFormat={}{0:0.00}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="-2" Maximum="2"
                                        Value="{Binding DepthContourDetailFactor}" Thumb.DragCompleted="TimeConsumingSlider_DragCompleted"
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Density_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DepthContourDensityFactor,StringFormat={}{0:0.00}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="-3.5" Maximum="3.5"
                                        Value="{Binding DepthContourDensityFactor}" Thumb.DragCompleted="TimeConsumingSlider_DragCompleted"
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>

                                                <CheckBox IsChecked="{Binding IsShowEnhancedMat}" Content="{Binding [Text_Show_Contour_Image], Source={x:Static core:LanguageManager.Instance}}"/>

                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Expander>
                                <CheckBox Content="{Binding [Text_Brightness_Sampling_Strategy], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsBrightnessMethodEnabled}"/>
                                <Expander Visibility="{Binding IsBrightnessMethodEnabled,Converter={StaticResource BooleanToVisibilityConverter}}" IsExpanded="True" Header="{Binding [Text_Brightness], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:Button Appearance="Primary" ToolTip="【可撤销】将明度采样到的点转移到手动采样中，以便进一步精细调整这些点" Icon="{ui:SymbolIcon Symbol=HandDraw24}" HorizontalAlignment="Stretch" Margin="0,0,0,4" Content="{Binding [Text_Migrate_to_Manual], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ConvertToManualCommand}" CommandParameter="b"/>
                                        <CheckBox Content="{Binding [Text_Darkness_Mode], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsDarknessMode}"/>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Basical_Density], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding BrightnessBaseDensity,StringFormat={}{0:0%}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="0.01" Maximum="1"
                                        Value="{Binding BrightnessBaseDensity}" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Brightness], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding BrightnessDensityFactor,StringFormat={}{0:0.00}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="-2" Maximum="2"
                                        Value="{Binding BrightnessDensityFactor}" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Contrast], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding BrightnessEnhanceGamma,StringFormat={}{0:0.00}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="-3.5" Maximum="3.5"
                                        Value="{Binding BrightnessEnhanceGamma}" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>

                                    </StackPanel>
                                </Expander>
                                <CheckBox Content="{Binding [Text_Manual_Sampling_Strategy], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsManualMethodEnabled}"/>
                                <Expander Visibility="{Binding IsManualMethodEnabled,Converter={StaticResource BooleanToVisibilityConverter}}" IsExpanded="True" Header="{Binding [Text_Manual], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Tool], Source={x:Static core:LanguageManager.Instance}}"/>
                                        </ui:TextBlock>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="1*" />
                                                <ColumnDefinition Width="1*" />
                                                <ColumnDefinition Width="1*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="1*" />
                                                <RowDefinition Height="1*" />
                                                <RowDefinition Height="1*" />
                                                <RowDefinition Height="1*" />
                                            </Grid.RowDefinitions>
                                            <ToggleButton Padding="0,7" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="0,0,2,0" 
                                                          ToolTip="鼠标，快捷键Q"  Command="{Binding SetManualToolCommand}" CommandParameter="0" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=0}">
                                                <ui:SymbolIcon Symbol="Cursor24"/>
                                            </ToggleButton>
                                            <ToggleButton Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,0" Grid.Column="1" 
                                                          ToolTip="【可撤销】铅笔，快捷键W，在“深度/采样预览图”中拖拽或单击，以在手动采样中添加一系列采样点或单个采样点"  Command="{Binding SetManualToolCommand}" CommandParameter="1" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=1}">
                                                <ui:SymbolIcon Symbol="Pen24"/>
                                            </ToggleButton>
                                            <ToggleButton Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,0,0,0" Grid.Column="2" 
                                                          ToolTip="【可撤销】橡皮擦，快捷键E，在“深度/采样预览图”中拖拽或单击，以在手动采样中移除一系列采样点" Command="{Binding SetManualToolCommand}" CommandParameter="2" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=2}">
                                                <ui:SymbolIcon Symbol="Eraser24"/>
                                            </ToggleButton>

                                            <ToggleButton Padding="0,7" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="0,4,2,0" Grid.Row="1" Grid.Column="0" 
                                                          ToolTip="【可撤销】线条，快捷键A，在“深度/采样预览图”中拖拽或单击，以在手动采样中添加一系列采样点或单个采样点" Command="{Binding SetManualToolCommand}" CommandParameter="3" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=3}">
                                                <ui:SymbolIcon Symbol="Line24"/>
                                            </ToggleButton>
                                            <ToggleButton Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,4,2,0" Grid.Row="1" Grid.Column="1" 
                                                          ToolTip="【可撤销】涂抹，快捷键S，在“深度/采样预览图”中拖拽或单击，以在手动采样中微调采样点的位置" Command="{Binding SetManualToolCommand}" CommandParameter="4" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=4}">
                                                <ui:SymbolIcon Symbol="HandDraw24"/>
                                            </ToggleButton>
                                            <ToggleButton Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,4,0,0" Grid.Row="1" Grid.Column="2" 
                                                          ToolTip="【可撤销】梯度偏移，快捷键D，在“深度/采样预览图”中拖拽或单击，以在手动采样中对采样点向梯度方向/反方向施加偏移" Command="{Binding SetManualToolCommand}" CommandParameter="5" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=5}">
                                                <ui:SymbolIcon Symbol="CalendarPattern20"/>
                                            </ToggleButton>

                                            <ToggleButton Padding="0,7" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="0,4,2,0" Grid.Row="2" Grid.Column="0" 
                                                          ToolTip="【可撤销】密度降低，快捷键Z，辅助你降低手动采样点量" Command="{Binding SetManualToolCommand}" CommandParameter="6" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=6}">
                                                <ui:SymbolIcon Symbol="ArrowSyncDismiss24"/>
                                            </ToggleButton>
                                            <ToggleButton Visibility="Collapsed" Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,4,2,0" Grid.Row="2" Grid.Column="1" 
                                                          ToolTip="【可撤销】" Command="{Binding SetManualToolCommand}" CommandParameter="7" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=7}">
                                                <ui:SymbolIcon Symbol="HandDraw24"/>
                                            </ToggleButton>
                                            <ToggleButton Visibility="Collapsed" Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="2,4,0,0" Grid.Row="2" Grid.Column="2" 
                                                          ToolTip="【可撤销】" Command="{Binding SetManualToolCommand}" CommandParameter="8" IsChecked="{Binding ManualTool,Mode=OneWay,Converter={StaticResource IntToBooleanConverter},ConverterParameter=8}">
                                                <ui:SymbolIcon Symbol="CalendarPattern20"/>
                                            </ToggleButton>

                                            <Button Grid.ColumnSpan="3" Background="#e44c55" Height="33" Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="0,4,2,0" Grid.Row="3" Grid.Column="0" 
                                                    ToolTip="【可撤销】清空，移除手动采样中所有采样点" Command="{Binding ClearManualPointsCommand}" CommandParameter="3">
                                                <ui:SymbolIcon Symbol="Delete24"/>
                                            </Button>

                                        </Grid>
                                        <Expander Margin="0,0,0,4" Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=1|3,Mode=OneWay}" IsExpanded="True" Header="{Binding [Text_Pencil_Settings], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Brush_Density], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding ManualDensity,StringFormat={}{0:0%}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0.01" Maximum="1"
                                        Value="{Binding ManualDensity}" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                            </StackPanel>
                                        </Expander>
                                        <Expander Margin="0,0,0,4" Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2,Mode=OneWay}" IsExpanded="True" Header="{Binding [Text_Eraser_Settings], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Eraser_Radius], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding EraserRadius,StringFormat={}{0:0.0}}"/>
                                                    <Run Text="px"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0" Maximum="{Binding RadiusMax}"
                                        Value="{Binding EraserRadius}" 
                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                                <!--
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Optional_Erasing], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding EraserRadius,StringFormat={}{0:0}}"/>
                                                    <Run Text="px"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="1" Maximum="50"
                                        Value="{Binding EraserRadius}" 
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                                                -->
                                                <ui:TextBlock Visibility="{Binding IsSmartEraserEnabled,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}">
                                                    <Run Text="{Binding [Text_Deepest], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding EraserLower,StringFormat={}{0:0.0}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0" Maximum="255" Visibility="{Binding IsSmartEraserEnabled,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}"
                                                        Value="{Binding EraserLower}" 
                                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock Visibility="{Binding IsSmartEraserEnabled,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}">
                                                    <Run Text="{Binding [Text_Shallowest], Source={x:Static core:LanguageManager.Instance}}" />
                                                    <Run Text="{Binding EraserUpper,StringFormat={}{0:0.0}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0" Maximum="255" Visibility="{Binding IsSmartEraserEnabled,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}"
                                                        Value="{Binding EraserUpper}" 
                                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                                <CheckBox Content="{Binding [Text_Smart_Eraser], Source={x:Static core:LanguageManager.Instance}}" ToolTip="开启后将自动选择背景采样点清除，对前景采样点则保留" IsChecked="{Binding IsSmartEraserEnabled}"/>

                                            </StackPanel>
                                        </Expander>
                                        <Expander Margin="0,0,0,4" Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=4,Mode=OneWay}" IsExpanded="True" Header="{Binding [Text_Smear_Settings], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Smear_Radius], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding SmearRadius,StringFormat={}{0:0.0}}"/>
                                                    <Run Text="px"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="1" Maximum="{Binding RadiusMax}"
                                        Value="{Binding SmearRadius}" 
                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Smear_Strength], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding SmearStrenth,StringFormat={}{0:0%}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="0.25" Maximum="4"
                                        Value="{Binding SmearStrenth}" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                            </StackPanel>
                                        </Expander>
                                        <Expander Margin="0,0,0,4" Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=5,Mode=OneWay}" IsExpanded="True" Header="{Binding [Text_Drafting_Tool], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>

                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Drafting_Brush_Radius], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DraftRadius,StringFormat={}{0:0.0}}"/>
                                                    <Run Text="px"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="1" Maximum="{Binding RadiusMax}"
                                                        Value="{Binding DraftRadius}" 
                                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                                <ui:TextBlock>
                                                    <Run Text="{Binding [Text_Drafting_Strength], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DraftStrength,StringFormat={}{0:0.0%}}"/>
                                                </ui:TextBlock>

                                                <Slider Minimum="-0.5" Maximum="0.5"
                                        Value="{Binding DraftStrength}" 
                                        TickFrequency="0.001" IsSnapToTickEnabled="True"/>

                                                <ui:Button HorizontalAlignment="Stretch" Margin="0,4,0,0" Content="{Binding [Text_Apply_Drafting_to_all_Points], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding GradientDraftCommand}"/>

                                            </StackPanel>
                                        </Expander>
                                        <Expander Margin="0,0,0,4" Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=6,Mode=OneWay}" IsExpanded="True" Header="{Binding [Text_Dedensing_Tool], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>
                                                <ui:ToggleSwitch Content="{Binding [Text_Uniform_Constraint], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsUniformDeduplicationEnabled}"/>
                                                <TextBlock>
                                                    <Run Text="{Binding [Text_Deduplication_Accuracy], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolAccuracy,StringFormat={}{0:0.0%}}"/>
                                                </TextBlock>
                                                <Slider Minimum="0" Maximum="1" Value="{Binding DeduplicationToolAccuracy}"/>
                                                <TextBlock>
                                                    <Run Text="{Binding [Text_Deduplication_Strength], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolDensity,StringFormat={}{0:0.0%}}"/>
                                                </TextBlock>
                                                <Slider Minimum="0" Maximum="1" Value="{Binding DeduplicationToolDensity}"/>
                                                <TextBlock Visibility="{Binding IsUniformDeduplicationEnabled,Converter={StaticResource BoolToVisibilityConverter}}" FontSize="8" Foreground="#FF808080">
                                                    <Run Text="{Binding [Text_Deduplication_Block_Size], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolGridWidth,StringFormat={}{0:0.0},Mode=OneWay}"/>
                                                    <Run Text="x"/>
                                                    <Run Text="{Binding DeduplicationToolGridHeight,StringFormat={}{0:0.0},Mode=OneWay}"/>
                                                    <Run Text="px"/>
                                                    <LineBreak/>
                                                    <Run Text="{Binding [Text_Maximum_Point_Count_for_Single_Block], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolMaxCount,StringFormat={}{0:0},Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Visibility="{Binding IsUniformDeduplicationEnabled,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}" FontSize="8" Foreground="#FF808080">
                                                    <Run Text="{Binding [Text_Deduplication_Block_Size], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolGridWidth,StringFormat={}{0:0.0},Mode=OneWay}"/>
                                                    <Run Text="x"/>
                                                    <Run Text="{Binding DeduplicationToolGridHeight,StringFormat={}{0:0.0},Mode=OneWay}"/>
                                                    <Run Text="px"/>
                                                    <LineBreak/>
                                                    <Run Text="{Binding [Text_Remove_X_Points_for_Each_Block_1], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding DeduplicationToolDensity,StringFormat={}{0:0%},Mode=OneWay}"/>
                                                    <Run Text="{Binding [Text_Remove_X_Points_for_Each_Block_2], Source={x:Static core:LanguageManager.Instance}}"/>
                                                </TextBlock>
                                                <ui:Button HorizontalAlignment="Stretch" Margin="0,4,0,0" Content="{Binding [Text_Run_Deduplication], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding DeduplicationCommand}"/>

                                            </StackPanel>
                                        </Expander>

                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="1*" />
                                                <ColumnDefinition Width="1*" />

                                            </Grid.ColumnDefinitions>
                                            <Button Margin="0,0,2,0" HorizontalAlignment="Stretch" ToolTip="撤销" Command="{Binding UndoStepCommand}">
                                                <ui:SymbolIcon Symbol="ArrowUndo24"/>
                                            </Button>
                                            <Button Margin="2,0,0,0" Grid.Column="1" HorizontalAlignment="Stretch" ToolTip="重做" Command="{Binding RedoStepCommand}">
                                                <ui:SymbolIcon Symbol="ArrowRedo24"/>
                                            </Button>
                                        </Grid>
                                        <Separator Margin="0,4"/>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_External_Operation], Source={x:Static core:LanguageManager.Instance}}"/>
                                        </ui:TextBlock>
                                        <Grid Margin="0,4,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="1*" />
                                                <ColumnDefinition Width="1*" />
                                            </Grid.ColumnDefinitions>
                                            <ui:Button Margin="0,0,2,0" Content="{Binding [Text_Export_Point_Map], Source={x:Static core:LanguageManager.Instance}}" HorizontalAlignment="Stretch" Icon="{ui:SymbolIcon Symbol=ArrowExportUp24}" Command="{Binding ExportPointsCommand}"/>
                                            <ui:Button Grid.Column="1" Margin="2,0,0,0" HorizontalAlignment="Stretch" Content="{Binding [Text_Import_Point_Map], Source={x:Static core:LanguageManager.Instance}}" Icon="{ui:SymbolIcon Symbol=ArrowImport24}" Command="{Binding ImportPointsCommand}"/>
                                        </Grid>
                                    </StackPanel>
                                </Expander>
                                <CheckBox Content="{Binding [Text_Post_Process], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPostProcessEnabled}"/>
                                <TextBlock Foreground="#D3D3D3" FontSize="8" Text="{Binding [Tips_Time_Consuming_Operations], Source={x:Static core:LanguageManager.Instance}}"/>
                                <Expander Visibility="{Binding IsPostProcessEnabled,Converter={StaticResource BooleanToVisibilityConverter}}" IsExpanded="True" Header="{Binding [Text_Post_Process], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <!--<CheckBox Content="{Binding [Globe_Dedeplication], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsDublicateRemoveEnabled}"/>-->
                                        <CheckBox IsChecked="{Binding IsExcludeMaskEnabled}">
                                            <TextBlock>
                                                <Run Text="{Binding [Text_Enable_Excluding], Source={x:Static core:LanguageManager.Instance}}"/>
                                                <InlineUIContainer>
                                                    <ui:Button BorderBrush="Transparent" VerticalAlignment="Bottom" Padding="0" Width="14" Height="14" Margin="0" Icon="{ui:SymbolIcon Symbol=Clock24}"
                                                               ToolTip="这是一个耗时操作"/>
                                                </InlineUIContainer>
                                            </TextBlock>
                                        </CheckBox>
                                        <Expander Visibility="{Binding IsExcludeMaskEnabled,Converter={StaticResource BooleanToVisibilityConverter}}" IsExpanded="True" Header="{Binding [Text_Pro_Deduplication], Source={x:Static core:LanguageManager.Instance}}">
                                            <StackPanel>
                                                <TextBlock>
                                                    <Run Text="{Binding [Text_Deepest_Preserving_Height], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding ExcludingRangeMin,StringFormat={}{0:0}}"/>
                                                </TextBlock>
                                                <Slider Thumb.DragCompleted="TimeConsumingSlider_DragCompleted" Minimum="0" Maximum="{Binding ExcludingRangeMax,Mode=OneWay}" Value="{Binding ExcludingRangeMin}"/>
                                                <TextBlock>
                                                    <Run Text="{Binding [Text_Shallowest_Preserving_Height], Source={x:Static core:LanguageManager.Instance}}"/>
                                                    <Run Text="{Binding ExcludingRangeMax,StringFormat={}{0:0}}"/>
                                                </TextBlock>
                                                <Slider Thumb.DragCompleted="TimeConsumingSlider_DragCompleted" Minimum="{Binding ExcludingRangeMin,Mode=OneWay}" Maximum="255" Value="{Binding ExcludingRangeMax}"/>

                                            </StackPanel>
                                        </Expander>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>

            </Grid>
        </Border>
        <GridSplitter Background="{DynamicResource ControlFillColorSecondaryBrush}" Grid.Row="1" Grid.Column="1" Grid.RowSpan="1" ResizeBehavior="PreviousAndNext" ResizeDirection="Columns" Width="5" />
        <Border Grid.Row="1" Grid.Column="2">
            <Grid ClipToBounds="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="300"  MinHeight="200"/>
                    <RowDefinition Height="5" />
                    <RowDefinition Height="1*" MinHeight="200"/>
                </Grid.RowDefinitions>
                <Image  Margin="0" Source="{Binding GradientColor}" Stretch="Fill"/>
                <Viewbox Margin="0" VerticalAlignment="Stretch" Stretch="Fill">
                    <Grid Height="255" ClipToBounds="True">
                        <Line X1="0"
                                X2="10"
                                Y1="{Binding EraserLower,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Y2="{Binding EraserLower,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Stroke="Black" StrokeThickness="1" RenderTransformOrigin="0.5,0.5">
                            <Line.RenderTransform>
                                <RotateTransform Angle="180"/>
                            </Line.RenderTransform>
                        </Line>
                        <Line X1="0"
                                X2="10"
                                Y1="{Binding EraserUpper,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Y2="{Binding EraserUpper,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Stroke="White" StrokeThickness="1" RenderTransformOrigin="0.5,0.5">
                            <Line.RenderTransform>
                                <RotateTransform Angle="180"/>
                            </Line.RenderTransform>
                        </Line>
                        <Line X1="0"
                                X2="10"
                                Y1="{Binding MouseDepth,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Y2="{Binding MouseDepth,Mode=OneWay,NotifyOnTargetUpdated=True}"
                                Stroke="#FF559CE4" StrokeThickness="1" RenderTransformOrigin="0.5,0.5">
                            <Line.RenderTransform>
                                <RotateTransform Angle="180"/>
                            </Line.RenderTransform>
                            <Line.Triggers>
                                <EventTrigger RoutedEvent="Binding.TargetUpdated">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Y1" Duration="00:00:0.1" To="{Binding MouseDepth}">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetProperty="Y2" Duration="00:00:0.1" To="{Binding MouseDepth}">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Line.Triggers>
                        </Line>
                    </Grid>
                </Viewbox>

                <Viewbox HorizontalAlignment="Center" Margin="4,0" VerticalAlignment="Stretch" Stretch="UniformToFill" MouseWheel="Viewbox_MouseWheel" MouseDown="Viewbox_MouseDown">
                    <Border Width="200" 
                            Height="200"
                            Background="{StaticResource ChessboardBrush}">
                    </Border>
                </Viewbox>
                <Grid ClipToBounds="True" Margin="4,0" SizeChanged="Grid_SizeChanged" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Grid>
                        <Grid.RenderTransform>
                            <TranslateTransform X="{Binding IndicatorX}" Y="{Binding IndicatorY}"/>
                        </Grid.RenderTransform>
                        <Line X1="0" Y1="0" X2="{Binding PreviewX}" Y2="{Binding PreviewY}" StrokeThickness="5" StrokeDashCap="Round" StrokeDashArray="0,3" Stroke="#88559CE4">
                            <Line.Style>
                                <Style TargetType="Line">
                                    <Setter Property="RenderTransform">
                                        <Setter.Value>
                                            <ScaleTransform ScaleX="{Binding PreviewScale,Mode=OneWay}" ScaleY="{Binding PreviewScale,Mode=OneWay}"/>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Visibility" Value="Hidden"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsOriginalImageLoaded}" Value="true">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Line.Style>
                        </Line>
                    </Grid>
                </Grid>
                <TextBlock HorizontalAlignment="Center" FontSize="10" Foreground="White" VerticalAlignment="Center" TextAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsOriginalImageLoaded}" Value="true">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                    <Run Text="{Binding [Tips_Could_Not_Take_Image_Back_1], Source={x:Static core:LanguageManager.Instance}}" FontSize="14"/>
                    <LineBreak/>
                    <Run Text="{Binding [Tips_Could_Not_Take_Image_Back_2], Source={x:Static core:LanguageManager.Instance}}"/>
                    <LineBreak/>
                    <Run Text="{Binding [Tips_Could_Not_Take_Image_Back_3], Source={x:Static core:LanguageManager.Instance}}"/>
                    <Hyperlink Command="{Binding RestoreViewCommand}">
                        <Hyperlink.Style>
                            <Style TargetType="Hyperlink">
                                <Setter Property="Foreground" Value="#559CE4"/>
                                <Style.Triggers>
                                    <EventTrigger RoutedEvent="Mouse.MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Duration="0:0:0.1" Storyboard.TargetProperty="Foreground.Color" To="#E46633"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="Mouse.MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Duration="0:0:0.5" Storyboard.TargetProperty="Foreground.Color" To="#559CE4"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Style.Triggers>
                            </Style>
                        </Hyperlink.Style>
                        <Run Text="{Binding [Tips_Could_Not_Take_Image_Back_4], Source={x:Static core:LanguageManager.Instance}}" />
                    </Hyperlink>
                </TextBlock>
                <TextBlock Visibility="{Binding IsDepthImageLoaded,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}" VerticalAlignment="Bottom" Foreground="#B3B3B3" Margin="0" FontSize="7">
                    <Run Text="暂无深度图"/>
                </TextBlock>

                <Grid Margin="4,0"  Cursor="Cross" ClipToBounds="True">


                    <Grid RenderTransformOrigin="0.5,0.5" Grid.ColumnSpan="2" Grid.RowSpan="2">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <TranslateTransform X="{Binding PreviewX}" Y="{Binding PreviewY}"/>
                                <ScaleTransform ScaleX="{Binding PreviewScale,Mode=OneWay}" ScaleY="{Binding PreviewScale,Mode=OneWay}"/>
                            </TransformGroup>
                        </Grid.RenderTransform>

                        <Image Name="MIMAGE" MouseWheel="Image_MouseWheel" MouseMove="Image_MouseMove" MouseDown="Image_MouseDown" MouseUp="Image_MouseUp" MouseLeave="Image_MouseLeave"
                           MaxHeight="300" Source="{Binding DisplayImageDepth}" Stretch="Uniform" IsHitTestVisible="{Binding IsManualEditable}"/>
                        <Image MaxHeight="300" Source="{Binding DisplayImageContour}" Opacity="{Binding OverlayOpacity}" Stretch="Uniform" IsHitTestVisible="False"/>
                        <Viewbox Visibility="{Binding MouseOnLMR,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=1|3}" Cursor="Cross" MaxHeight="300" Stretch="Uniform" IsHitTestVisible="False">
                            <Grid>
                                <Canvas Visibility="{Binding IsManualEditing,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Line Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=3,Mode=OneWay}" X1="{Binding StartMousePointX,Mode=OneWay}" Y1="{Binding StartMousePointY,Mode=OneWay}" X2="{Binding MousePointX,Mode=OneWay}" Y2="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False" Stroke="White" StrokeThickness="2"/>
                                </Canvas>
                                <Canvas Visibility="{Binding IsMouseMoving,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Ellipse Canvas.Left="{Binding MousePointX,Mode=OneWay}"
                                             Canvas.Top="{Binding MousePointY,Mode=OneWay}"
                                             Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2|4|5,Mode=OneWay}"
                                             Width="{Binding ToolDiameter,Mode=OneWay}"
                                             Height="{Binding ToolDiameter,Mode=OneWay}"
                                             IsHitTestVisible="False"
                                             Fill="#AAFFFFFF"
                                             Stroke="White"
                                             StrokeThickness="2">
                                        <Ellipse.RenderTransform>
                                            <TransformGroup>
                                                <TranslateTransform X="{Binding MToolRadius,Mode=OneWay}" Y="{Binding MToolRadius,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Ellipse.RenderTransform>
                                    </Ellipse>

                                    <Border Padding="8" CornerRadius="0,16,16,16" Background="{Binding MouseDepthColorBW}" Canvas.Left="{Binding MousePointX,Mode=OneWay}" Canvas.Top="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False">
                                        <Border.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="{Binding RePreviewScale,Mode=OneWay}" ScaleY="{Binding RePreviewScale,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Border.RenderTransform>
                                        <TextBlock Foreground="{Binding MouseDepthColor}" FontSize="48" FontWeight="Bold">
                                            <Run Text="D"/>
                                            <Run Text="{Binding MouseDepth,StringFormat={}{0:0.00},Mode=OneWay}"/>
                                        </TextBlock>
                                    </Border>
                                </Canvas>
                            </Grid>
                        </Viewbox>
                    </Grid>
                </Grid>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1*" />
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>
                    <Border Background="#E3559CE4" BorderThickness="2" BorderBrush="#80B9EE" 
                        Margin="8,4,8,2" 
                        Visibility="{Binding IsDragEntered,Converter={StaticResource BoolToVisibilityConverter}}"
                        Drop="BorderDepthImage_Drop">
                        <TextBlock TextAlignment="Center" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ui:SymbolIcon Symbol="DocumentCatchUp24" FontSize="32"/>
                        <LineBreak/>
                        <Run Text="{Binding [Text_Import_Depth_Map], Source={x:Static core:LanguageManager.Instance}}"/>
                        </TextBlock>
                    </Border>
                    <Border Background="#E3559CE4" Grid.Row="1" BorderThickness="2" BorderBrush="#80B9EE" 
                        Margin="8,2,8,4" 
                        Visibility="{Binding IsDragEntered,Converter={StaticResource BoolToVisibilityConverter}}"
                        Drop="BorderPointMap_Drop">
                        <TextBlock TextAlignment="Center" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ui:SymbolIcon Symbol="GridDots24" FontSize="32"/>
                        <LineBreak/>
                        <Run Text="{Binding [Text_Import_Point_Map], Source={x:Static core:LanguageManager.Instance}}"/>
                        </TextBlock>
                    </Border>
                </Grid>

                <GridSplitter Background="{DynamicResource ControlFillColorSecondaryBrush}" ResizeBehavior="PreviousAndNext" Grid.Row="1" ResizeDirection="Rows" Height="5" HorizontalAlignment="Stretch"/>

                <TextBlock Grid.Row="2" Foreground="#FFD3D3D3" Text="┑(￣Д ￣)┍" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}"/>
                <ScrollViewer Grid.Row="2">
                    <StackPanel Margin="8">
                        <Expander Header="{Binding [Text_Depth_and_Sampling_Preview], Source={x:Static core:LanguageManager.Instance}}" IsExpanded="True" Margin="8" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <ui:TextBlock>
                                    <Run Text="{Binding [Text_Color_of_Depth_Map], Source={x:Static core:LanguageManager.Instance}}"/>
                                </ui:TextBlock>
                                <ComboBox SelectedIndex="{Binding DepthColor}">
                                    <ComboBoxItem Content="Autumn"/>
                                    <ComboBoxItem Content="Bone"/>
                                    <ComboBoxItem Content="Jet"/>
                                    <ComboBoxItem Content="Winter"/>
                                    <ComboBoxItem Content="Rainbow"/>
                                    <ComboBoxItem Content="Ocean"/>
                                    <ComboBoxItem Content="Summer"/>
                                    <ComboBoxItem Content="Spring"/>
                                    <ComboBoxItem Content="Cool"/>
                                    <ComboBoxItem Content="Hsv"/>
                                    <ComboBoxItem Content="Pink"/>
                                    <ComboBoxItem Content="Hot"/>
                                    <ComboBoxItem Content="Parula"/>
                                    <ComboBoxItem Content="Magma"/>
                                    <ComboBoxItem Content="Inferno"/>
                                    <ComboBoxItem Content="Plasma"/>
                                    <ComboBoxItem Content="Viridis"/>
                                    <ComboBoxItem Content="Cividis"/>
                                    <ComboBoxItem Content="Twilight"/>
                                    <ComboBoxItem Content="TwilightShifted"/>
                                    <ComboBoxItem Content="Turbo"/>
                                    <ComboBoxItem Content="DeepGreen"/>
                                </ComboBox>
                                <Expander  IsExpanded="True" Margin="0,4,0,0" Header="{Binding [Text_View], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Ratio_of_Point_and_Depth], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding OverlayOpacity,StringFormat={}{0:0%}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="0" Maximum="1" 
                            Value="{Binding OverlayOpacity}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Scale], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding PreviewScale,Mode=OneWay,StringFormat={}{0:0%}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="-0.5" Maximum="0.5" 
                            Value="{Binding PreviewScaleFactor}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True"/>

                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Position], Source={x:Static core:LanguageManager.Instance}}"/>
                                        </ui:TextBlock>
                                        <Grid Margin="0,4,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="20" />
                                                <ColumnDefinition Width="1*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="1*" />
                                                <RowDefinition Height="4" />
                                                <RowDefinition Height="1*" />
                                            </Grid.RowDefinitions>
                                            <ui:TextBlock VerticalAlignment="Center" HorizontalAlignment="Center">
                                                <Run Text="X"/>
                                            </ui:TextBlock>
                                            <ui:NumberBox Grid.Row="0" Grid.Column="1" MaxDecimalPlaces="1" Value="{Binding PreviewX}"/>
                                            <ui:TextBlock Grid.Row="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <Run Text="Y"/>
                                            </ui:TextBlock>
                                            <ui:NumberBox Grid.Row="2" Grid.Column="1" MaxDecimalPlaces="1" Value="{Binding PreviewY}"/>

                                        </Grid>
                                        <ui:Button Icon="{ui:SymbolIcon Symbol=ArrowRotateCounterclockwise24}" Content="{Binding [Text_Restore_View], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding RestoreViewCommand}" Margin="0,4,0,0" HorizontalAlignment="Stretch"/>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </Expander>
                        <Expander Header="{Binding [Text_Scratch_Path_Generate], Source={x:Static core:LanguageManager.Instance}}" IsExpanded="True" Margin="8" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter}}">

                            <StackPanel IsEnabled="{Binding IsNotProcessingSvg}">
                                
                                <ui:TextBlock>
                                    <Run Text="{Binding [Path_Generating_Mode], Source={x:Static core:LanguageManager.Instance}}"/>
                                </ui:TextBlock>

                                <ComboBox SelectedIndex="{Binding PathGeneratingMode}">
                                    <ComboBoxItem Content="Default"></ComboBoxItem>
                                    <ComboBoxItem Content="Handcraft"></ComboBoxItem>
                                    <ComboBoxItem Content="Occlusion"></ComboBoxItem>
                                </ComboBox>
                                <CheckBox Grid.Column="1" Content="{Binding [Text_Auto_Update_Preview], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsAutoGeneratePreview}"/>

                                <Grid>
                                    <ui:Flyout x:Name="WarningFlyout"
                                            Placement="Top">
                                        <StackPanel>

                                            <TextBlock Text="{Binding [Tips_OH], Source={x:Static core:LanguageManager.Instance}}" FontWeight="Bold" FontSize="24" Margin="0,0,0,4"/>
                                            <TextBlock LineHeight="20"
                                            Width="280"
                                            HorizontalAlignment="Left"
                                            TextWrapping="WrapWithOverflow">
                                            <Run Text="{Binding [Tips_Point_Count_Overflow], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding PointCount,Mode=OneWay}"/>
                                            <Run Text=" > "/>
                                            <Run Text="{Binding MaximumPointCount,Mode=OneWay}"/>
                                            <Run Text=")"/>
                                            <LineBreak/>
                                            <Run Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_1], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <LineBreak/>
                                            <LineBreak/>
                                            <Run Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_2], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run FontWeight="Bold" Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_3], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_4], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run FontWeight="Bold" Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_5], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_6], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <LineBreak/>
                                            <Run Text="{Binding [Tips_Number_of_Scratch_Paths_is_Determined_by_Point_Count_7], Source={x:Static core:LanguageManager.Instance}}"/>
                                            </TextBlock>
                                            <ui:NumberBox Value="{Binding MaximumPointCount,UpdateSourceTrigger=PropertyChanged}" Minimum="1"/>
                                            <ui:Button Appearance="Primary" Margin="0,8,0,0" Content="{Binding [Globe_Sure], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding CloseWarningCommand}"/>
                                        </StackPanel>
                                    </ui:Flyout>
                                    <ui:Button HorizontalAlignment="Stretch" Content="{Binding [Text_Generate_Preview_Path], Source={x:Static core:LanguageManager.Instance}}" Appearance="Primary" Command="{Binding CreateScratchCommand}"/>
                                </Grid>
                                <Separator Margin="0,4"/>

                                <ui:TextBlock>
                                    <Run Text="{Binding [Text_Ignoring_Range_of_Points_around_Zero_1], Source={x:Static core:LanguageManager.Instance}}"/>
                                    <Run Text="{Binding IgnoreZeroDepthDistance,StringFormat={}{0:0}}"/>
                                    <Run Text="{Binding [Text_Ignoring_Range_of_Points_around_Zero_2], Source={x:Static core:LanguageManager.Instance}}"/>
                                </ui:TextBlock>
                                <Slider Minimum="0" Maximum="255" 
                            Value="{Binding IgnoreZeroDepthDistance}" 
                            TickFrequency="1" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>

                                <ui:TextBlock>
                                    <Run Text="{Binding [Text_Zero], Source={x:Static core:LanguageManager.Instance}}"/>
                                    <Run Text="{Binding ZeroDepth,StringFormat={}{0:0}}"/>
                                </ui:TextBlock>
                                <Slider Minimum="0" Maximum="255" 
                            Value="{Binding ZeroDepth}" 
                            TickFrequency="1" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>

                                <Expander Visibility="{Binding IsGeneratingHandCraftSketchMode,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}" IsExpanded="True" Margin="0,4,0,0" Header="{Binding [Text_Path_Arguments], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Curvature_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding AFactor,StringFormat={}{0:0.00}}"/>
                                        </ui:TextBlock>
                                        <Slider Minimum="0" Maximum="1" 
                            Value="{Binding AFactor}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>

                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Stretching_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding BFactor,StringFormat={}{0:0}}"/>
                                        </ui:TextBlock>
                                        <Slider Minimum="500" Maximum="3000" 
                            Value="{Binding BFactor}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>
                                    </StackPanel>
                                </Expander>
                                <Expander Visibility="{Binding IsGeneratingHandCraftSketchMode,Converter={StaticResource BoolToVisibilityConverter}}" IsExpanded="True" Margin="0,4,0,0" Header="{Binding [Text_Path_Arguments], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Radius_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding RadiusFactor,StringFormat={}{0:0.00}}"/>
                                        </ui:TextBlock>
                                        <Slider Minimum="0.5" Maximum="2" 
                            Value="{Binding RadiusFactor}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>

                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Angle_Factor], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding AngleFactor,StringFormat={}{0:0}}"/>
                                        </ui:TextBlock>
                                        <Slider Minimum="10" Maximum="60" 
                            Value="{Binding AngleFactor}" 
                            TickFrequency="0.01" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>
                                    </StackPanel>
                                </Expander>

                            </StackPanel>
                        </Expander>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
        <GridSplitter Background="{DynamicResource ControlFillColorSecondaryBrush}" Grid.Row="1" Grid.Column="3" Grid.RowSpan="1" ResizeBehavior="PreviousAndNext" ResizeDirection="Columns" Width="5" />
        <Border Grid.Row="1" Grid.Column="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="300" MinHeight="200"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="1*" />
                </Grid.RowDefinitions>
                <Viewbox HorizontalAlignment="Center" Margin="0" Stretch="UniformToFill" MouseWheel="Viewbox_MouseWheel" MouseDown="Viewbox_MouseDown">
                    <Border HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Width="200" Height="200"
                       Background="{StaticResource ChessboardBrush}">
                    </Border>
                </Viewbox>
                <Grid  Margin="0" ClipToBounds="True">
                    <Grid RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <TranslateTransform X="{Binding PreviewX}" Y="{Binding PreviewY}"/>
                                <ScaleTransform ScaleX="{Binding PreviewScale,Mode=OneWay}" ScaleY="{Binding PreviewScale,Mode=OneWay}"/>
                            </TransformGroup>
                        </Grid.RenderTransform>
                        <Image  MaxHeight="300" Name="RIMAGE"
                        Visibility="Visible" Opacity="0.05"
                        Source="{Binding FilePath}" IsHitTestVisible="True"
                        Stretch="Uniform" MouseMove="Image_MouseMove" MouseLeave="Image_MouseLeave" MouseUp="Image_MouseUp" MouseDown="Image_MouseDown" MouseWheel="Image_MouseWheel">
                        </Image>
                        <Image  MaxHeight="300" IsHitTestVisible="False"
                        Visibility="{Binding IsPreviewingOriginImage,Converter={StaticResource BooleanToVisibilityConverter}}"
                        Source="{Binding FilePath}"
                        Stretch="Uniform">
                        </Image>
                        <Image MaxHeight="300" IsHitTestVisible="False"
                       Source="{Binding DisplayImageScratchLine}" 
                       Visibility="{Binding IsPreviewingLine,Converter={StaticResource BooleanToVisibilityConverter}}"
                       Stretch="Uniform"/>
                        <Image MaxHeight="300" IsHitTestVisible="False"
                       Source="{Binding DisplayImageScratchL}" 
                       Visibility="{Binding IsPreviewingLeft,Converter={StaticResource BooleanToVisibilityConverter}}"
                       Stretch="Uniform"/>
                        <Image MaxHeight="300" IsHitTestVisible="False"
                       Source="{Binding DisplayImageScratchR}"
                       Visibility="{Binding IsPreviewingRight,Converter={StaticResource BooleanToVisibilityConverter}}"
                       Stretch="Uniform"/>
                        <Image MaxHeight="300" IsHitTestVisible="False"
                       Source="{Binding DisplayImageScratchO}"
                       Visibility="{Binding IsPreviewingOrigin,Converter={StaticResource BooleanToVisibilityConverter}}"
                       Stretch="Uniform"/>
                        <Image MaxHeight="300" IsHitTestVisible="False"
                       Source="{Binding DisplayImageScratchStep}"
                       Visibility="{Binding IsPreviewingStep,Converter={StaticResource BooleanToVisibilityConverter}}"
                       Stretch="Uniform"/>
                        <Viewbox Visibility="{Binding MouseOnLMR,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2|3}" Cursor="Cross" MaxHeight="300" Stretch="Uniform" IsHitTestVisible="False">
                            <Grid>
                                <Canvas Visibility="{Binding IsManualEditing,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Line Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=3,Mode=OneWay}" X1="{Binding StartMousePointX,Mode=OneWay}" Y1="{Binding StartMousePointY,Mode=OneWay}" X2="{Binding MousePointX,Mode=OneWay}" Y2="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False" Stroke="White" StrokeThickness="2"/>
                                </Canvas>
                                <Canvas Visibility="{Binding IsMouseMoving,Converter={StaticResource BoolToVisibilityConverter}}" Width="{Binding OriginImageWidth}" Height="{Binding OriginImageHeight}">
                                    <Ellipse Canvas.Left="{Binding MousePointX,Mode=OneWay}"
                                             Canvas.Top="{Binding MousePointY,Mode=OneWay}"
                                             Visibility="{Binding ManualTool,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2|4|5,Mode=OneWay}"
                                             Width="{Binding ToolDiameter,Mode=OneWay}"
                                             Height="{Binding ToolDiameter,Mode=OneWay}"
                                             IsHitTestVisible="False"
                                             Fill="#AAFFFFFF"
                                             Stroke="White"
                                             StrokeThickness="2">
                                        <Ellipse.RenderTransform>
                                            <TransformGroup>
                                                <TranslateTransform X="{Binding MToolRadius,Mode=OneWay}" Y="{Binding MToolRadius,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Ellipse.RenderTransform>
                                    </Ellipse>

                                    <Border Padding="8" CornerRadius="0,16,16,16" Background="{Binding MouseDepthColorBW}" Canvas.Left="{Binding MousePointX,Mode=OneWay}" Canvas.Top="{Binding MousePointY,Mode=OneWay}" IsHitTestVisible="False">
                                        <Border.RenderTransform>
                                            <TransformGroup>
                                                <ScaleTransform ScaleX="{Binding RePreviewScale,Mode=OneWay}" ScaleY="{Binding RePreviewScale,Mode=OneWay}"/>
                                            </TransformGroup>
                                        </Border.RenderTransform>
                                        <TextBlock Foreground="{Binding MouseDepthColor}" FontSize="48" FontWeight="Bold">
                                            <Run Text="D"/>
                                            <Run Text="{Binding MouseDepth,StringFormat={}{0:0.00},Mode=OneWay}"/>
                                        </TextBlock>
                                    </Border>
                                </Canvas>
                            </Grid>
                        </Viewbox>

                    </Grid>
                </Grid>
                <GridSplitter Background="{DynamicResource ControlFillColorSecondaryBrush}" ResizeBehavior="PreviousAndNext" Grid.Row="1" ResizeDirection="Rows" Height="5" HorizontalAlignment="Stretch"/>

                <TextBlock Grid.Row="2" Foreground="#FFD3D3D3" Text="（ ゜- ゜）つロ" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter},ConverterParameter=I}"/>

                <ScrollViewer Grid.Row="2">
                    <StackPanel Margin="8">
                        <Expander Header="{Binding [Text_Scratch_Path_Preview], Source={x:Static core:LanguageManager.Instance}}" IsExpanded="True" Margin="8" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter}}">

                            <StackPanel IsEnabled="{Binding IsNotProcessingSvg}" Grid.Row="1">
                                <CheckBox Content="{Binding [Globe_Original_Image], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingOriginImage}"/>
                                <CheckBox Content="{Binding [Text_Start_Point], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingLeft}"/>
                                <CheckBox Content="{Binding [Text_End_Point], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingRight}"/>
                                <CheckBox Content="{Binding [Text_Original_Point], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingOrigin}"/>
                                <CheckBox Content="{Binding [Globe_Path], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingLine}"/>
                                <Expander IsExpanded="True" Visibility="{Binding IsPreviewingLine,Converter={StaticResource BooleanToVisibilityConverter}}" Header="{Binding [Text_Preview_Control], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock>
                                            <Run Text="{Binding [Text_Preview_Density], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding PreviewDense,StringFormat={}{0:0}}"/>
                                            <InlineUIContainer>
                                                <ui:Button Padding="0" Width="14" Height="14" Margin="0" Icon="{ui:SymbolIcon Symbol=Question24}"
                                                           ToolTip="只会影响预览，不影响输出结果"/>
                                            </InlineUIContainer>
                                        </ui:TextBlock>
                                        <Slider Minimum="100" Maximum="200" 
                                                Value="{Binding PreviewDense}" 
                                                TickFrequency="5" TickPlacement="BottomRight" IsSnapToTickEnabled="True" PreviewMouseUp="Slider_MouseUp"/>
                                        <CheckBox Content="{Binding [Text_Show_Path_Density], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingLineDensity}"/>


                                    </StackPanel>
                                </Expander>
                                <CheckBox Content="{Binding [Text_Dynamic_Preview], Source={x:Static core:LanguageManager.Instance}}" IsChecked="{Binding IsPreviewingStep}"/>

                                <Expander IsExpanded="True" Visibility="{Binding IsPreviewingStep,Converter={StaticResource BooleanToVisibilityConverter}}" Header="{Binding [Text_Preview_Control], Source={x:Static core:LanguageManager.Instance}}">
                                    <StackPanel>
                                        <ui:TextBlock Visibility="{Binding IsPreviewingStep,Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Run Text="{Binding [Globe_Step], Source={x:Static core:LanguageManager.Instance}}"/>
                                            <Run Text="{Binding PreviewT,StringFormat={}{0:0.00}}"/>
                                        </ui:TextBlock>

                                        <Slider Minimum="0"
                                        Maximum="1" 
                                        Value="{Binding PreviewT}"
                                        TickFrequency="0.05"
                                        TickPlacement="BottomRight"
                                        IsSnapToTickEnabled="True"/>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowPrevious24}" Grid.Column="0" Command="{Binding ChangePreviewCommand}" CommandParameter="0"/>
                                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowLeft24}" Grid.Column="1" Command="{Binding ChangePreviewCommand}" CommandParameter="1"/>
                                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=CenterHorizontal24}" Grid.Column="2" Command="{Binding ChangePreviewCommand}" CommandParameter="4"/>
                                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowRight24}" Grid.Column="3" Command="{Binding ChangePreviewCommand}" CommandParameter="2"/>
                                            <ui:Button Padding="2" HorizontalAlignment="Stretch" Margin="2,0" Icon="{ui:SymbolIcon Symbol=ArrowNext24}" Grid.Column="4" Command="{Binding ChangePreviewCommand}" CommandParameter="3"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto"/>
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock VerticalAlignment="Center">
                                                <Run Text="{Binding [Text_Color_of_Points], Source={x:Static core:LanguageManager.Instance}}"/>
                                                <ui:SymbolIcon Symbol="Question24" Margin="-2" ToolTip="单色HEX：#色号 原色：c 深度：d"/>
                                            </TextBlock>
                                            <ui:TextBox PlaceholderText="# / c / d" Grid.Column="1" Visibility="{Binding IsPreviewingStep,Converter={StaticResource BooleanToVisibilityConverter}}"
                                            Text="{Binding PreviewColorful,UpdateSourceTrigger=LostFocus}"/>
                                        </Grid>
                                        <ui:Button Content="{Binding [Text_3D_View], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding Open3DPreviewCommand}">
                                            <ui:Button.Icon>
                                                <ui:SymbolIcon FontWeight="Bold" Symbol="Glasses24">
                                                    <ui:SymbolIcon.Foreground>
                                                        <LinearGradientBrush StartPoint="0,0.5" EndPoint="1,0.5">
                                                            <GradientStop Color="Red" Offset="0"/>
                                                            <GradientStop Color="Blue" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </ui:SymbolIcon.Foreground>
                                                </ui:SymbolIcon>

                                            </ui:Button.Icon>
                                        </ui:Button>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </Expander>
                        <Expander Header="{Binding [Globe_Export], Source={x:Static core:LanguageManager.Instance}}" IsExpanded="True" Margin="8" Visibility="{Binding IsOriginalImageLoaded,Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <ui:Button IsEnabled="{Binding IsNotProcessingSvg}" Visibility="{Binding PathGeneratingMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=0}" Appearance="Primary" HorizontalAlignment="Stretch" Content="{Binding [Text_Export_Scratch_Path], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ExportPathCommand}">

                                </ui:Button>
                                
                                <ui:Button IsEnabled="{Binding IsNotProcessingSvg}" Visibility="{Binding PathGeneratingMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=2}" Appearance="Primary" HorizontalAlignment="Stretch" Content="{Binding [Text_Export_Shaded_Scratch_Path], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ExportPathCommand}">

                                </ui:Button>
                                
                                <ui:TextBlock Visibility="{Binding PathGeneratingMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=1}" ToolTip="">
                                    <Run Text="{Binding [Text_Number_of_Layers], Source={x:Static core:LanguageManager.Instance}}"/>
                                    <ui:SymbolIcon Symbol="Question24" Margin="-2" ToolTip="输出草图的层数，理论上越大精度越高，但是你的工作量也会线性增长"/>
                                </ui:TextBlock>
                                <ui:NumberBox Margin="0,4" Visibility="{Binding PathGeneratingMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=1}" Value="{Binding LayerCount}"/>
                                <ui:Button IsEnabled="{Binding IsNotProcessingSvg}" Visibility="{Binding PathGeneratingMode,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=1}" Appearance="Primary" HorizontalAlignment="Stretch" Content="{Binding [Text_Export_Handcraft_Blueprint], Source={x:Static core:LanguageManager.Instance}}" Command="{Binding ExportPathCommand}">

                                </ui:Button>

                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

        </Border>

        <StackPanel Grid.Row="2" Grid.ColumnSpan="5" Orientation="Horizontal">
            <ui:Button ToolTip="开源信息" Command="{Binding OpenCustomMessageBoxCommand}" Padding="0" Width="24" Height="24" Margin="4" Icon="{ui:SymbolIcon Symbol=BookInformation24}"/>
            <ui:HyperlinkButton Margin="0" Padding="0" FontSize="12"
                                Icon="{ui:SymbolIcon Symbol=Code24}"
                                ToolTip="在 Github 上查看源代码"
                                NavigateUri="https://github.com/POPCORNBOOM/EZHolodotNet"/>
            <ui:HyperlinkButton Margin="0" Padding="0" FontSize="12"
                                Icon="{ui:SymbolIcon Symbol=VideoClip24}"
                                ToolTip="在 Bilibili 上查看教学视频"
                                NavigateUri="https://www.bilibili.com/video/BV1moCHYxEPk"/>
            <TextBlock Foreground="LightGray" FontSize="8" VerticalAlignment="Center">
                <Run Text="EZHolo @ hs2.0"/>
                <LineBreak/>
                <Run Text="Copyright © 2025 Yigu Wang"/>
            </TextBlock>
            <TextBlock Margin="8,0" Foreground="LightGray" FontSize="8" VerticalAlignment="Center">
                <Run Text="{Binding [Text_Output_Maximum], Source={x:Static core:LanguageManager.Instance}}"/>
                <Run Text="{Binding MaximumPointCount}"/>
                <Run Text="{Binding [Globe_Point], Source={x:Static core:LanguageManager.Instance}}"/>
            </TextBlock>
        </StackPanel>
        <Grid Margin="0,0,8,0" Grid.Row="2" Grid.ColumnSpan="5" HorizontalAlignment="Right">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <ui:TextBlock Foreground="Gray" FontSize="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Run Text="{Binding [Text_Total_Point_Count], Source={x:Static core:LanguageManager.Instance}}"/>
                <Run Foreground="{DynamicResource HyperlinkButtonForeground}" Text="{Binding PointCount,Mode=OneWay}"/>
                <Run Text="("/>
                <Run Text="{Binding ContourPointCount,Mode=OneWay}"/>
                <Run Text="轮廓点 +"/>
                <Run Text="{Binding BrightnessPointCount,Mode=OneWay}"/>
                <Run Text="明度点 +"/>
                <Run Text="{Binding ManualPointCount,Mode=OneWay}"/>
                <Run Text="手动点 -"/>
                <Run Text="{Binding ExcludedPointCount,Mode=OneWay}"/>
                <Run Text="排除点)"/>
                <Run Text="{Binding [Text_Pixel], Source={x:Static core:LanguageManager.Instance}}"/>
                <Run Foreground="{DynamicResource HyperlinkButtonForeground}" Text="{Binding MousePointX,Mode=OneWay}"/>
                <Run Text=","/>
                <Run Foreground="{DynamicResource HyperlinkButtonForeground}" Text="{Binding MousePointY,Mode=OneWay}"/>                      
                <Run Text="{Binding [Text_Height], Source={x:Static core:LanguageManager.Instance}}"/>
                <Run Foreground="{DynamicResource HyperlinkButtonForeground}" Text="{Binding MouseDepth,StringFormat={}{0:0.00},Mode=OneWay}"/>
            </ui:TextBlock>

            <Viewbox Grid.Column="1" Height="12">
                <Grid Height="255" Width="255">
                    <Image Width="200" HorizontalAlignment="Center" Source="{Binding GradientColor}" Stretch="Fill"/>
                    <Line X1="0" X2="255" Y1="{Binding MouseDepth,Mode=OneWay}" Y2="{Binding MouseDepth,Mode=OneWay}" Stroke="Red" StrokeThickness="30" RenderTransformOrigin="0.5,0.5">
                        <Line.RenderTransform>
                            <RotateTransform Angle="180"/>
                        </Line.RenderTransform>
                    </Line>
                </Grid>
            </Viewbox>
            <ui:TextBlock Foreground="Gray" FontSize="8" VerticalAlignment="Center" Grid.Column="2" HorizontalAlignment="Center">
                <Run Text="{Binding [Text_Gradient], Source={x:Static core:LanguageManager.Instance}}"/>
                <Run Foreground="{DynamicResource HyperlinkButtonForeground}" Text="{Binding MouseGradient,StringFormat={}{0:0.00},Mode=OneWay}"/>
            </ui:TextBlock>

            <Viewbox Margin="2,0,0,0" Grid.Column="3" Height="12">
                <Grid Height="512" Width="512">
                    <Ellipse Width="512" Height="512" Fill="{DynamicResource HyperlinkButtonForeground}"/>
                    <Line StrokeEndLineCap="Triangle" X1="255" X2="{Binding MouseGradientX,Mode=OneWay}" Y1="255" Y2="{Binding MouseGradientY,Mode=OneWay}" Stroke="White" StrokeThickness="30" RenderTransformOrigin="0.5,0.5">

                    </Line>
                </Grid>
            </Viewbox>
            <ui:Flyout Grid.Column="4"
                IsOpen="{Binding IsShowMissionFlyout,Mode=TwoWay}"
                Placement="Top">
                <StackPanel Width="300">
                    <TextBlock
        HorizontalAlignment="Left"
        Text="任务"/>
                    <Separator Margin="0,4"/>
                    <Grid>
                        <!-- 实际任务列表 -->

                        <ui:ListView ItemsSource="{Binding ProgressedMissions}">
                            <ui:ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid Grid.Column="0">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="1*" />
                                                <RowDefinition Height="1*" />
                                            </Grid.RowDefinitions>
                                            <TextBlock Text="{Binding Title}"/>
                                            <TextBlock FontSize="8" Grid.Row="1" Text="{Binding Detail}"/>
                                        </Grid>

                                        <ProgressBar Grid.Column="1" Maximum="1" Value="{Binding ProgressValue}"/>
                                    </Grid>
                                </DataTemplate>
                            </ui:ListView.ItemTemplate>
                        </ui:ListView>

                        <!-- 无任务占位（当 ProgressedMissionsCount == 0 时显示） -->
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ProgressedMissionsCount}" Value="0">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <TextBlock Text="无任务"/>
                            <ui:SymbolIcon
                        Symbol="Snooze24" />
                        </StackPanel>

                    </Grid>
                </StackPanel>
            </ui:Flyout>
            <ui:Button Margin="2,0,0,0" Padding="0" Appearance="Primary" Icon="{ui:SymbolIcon Symbol=PersonRunning20 }"
                    Grid.Column="4" Height="20" Width="30"
                    Command="{Binding ShowMissionFlyoutCommand}">
                <TextBlock Margin="-6,0,0,0" FontSize="8" Text="{Binding ProgressedMissionsCount}">

                </TextBlock>

            </ui:Button>
        </Grid>

    </Grid>
</ui:FluentWindow>
